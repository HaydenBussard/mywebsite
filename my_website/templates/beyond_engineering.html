{% extends 'base.html' %}
{% load static %}

{% block title %}{{ page.browser_title }}{% endblock %}

{% block content %}
<div class="container my-5">
    
    {% if page.main_header %}
    <h1 class="mb-4">{{ page.main_header }}</h1>
    {% endif %}

    {% for section in sections %}
        <section class="mb-5">
            <h2>{{ section.title }}</h2>
            
            {% if section.intro_paragraph %}
            <p>{{ section.intro_paragraph|linebreaksbr }}</p>
            {% endif %}
            
            {% with details=section.details.all %}
                {% for detail in details %}
                    {% if detail.detail_type == 'LI' %}
                        
                        {# Safely extract the previous item. details|slice:forloop.counter0|last returns the element before the current one #}
                        {% with previous_item=details|slice:forloop.counter0|last %}
                            {# Start <ul> if this is the first item OR the previous item is not an LI (or doesn't exist) #}
                            {% if forloop.first or previous_item.detail_type != 'LI' %}
                                <ul>
                            {% endif %}
                        {% endwith %}
                        
                        <li>{{ detail.content }}</li>

                        {# Safely extract the next item. details|slice:forloop.counter|first returns the element after the current one #}
                        {% with next_item=details|slice:forloop.counter|first %}
                            {# End </ul> if this is the last item OR the next item is not an LI #}
                            {% if forloop.last or next_item.detail_type != 'LI' %}
                                </ul>
                            {% endif %}
                        {% endwith %}
                        
                    {% elif detail.detail_type == 'P' %}
                        <p>{{ detail.content|linebreaksbr }}</p>
                    {% endif %}
                {% endfor %}
            {% endwith %}
        </section>
    {% endfor %}
</div>
{% endblock %}